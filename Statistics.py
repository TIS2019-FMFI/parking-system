from Record import Recordfrom BOX import Boximport csvimport datetimefrom datetime import datefrom Finder import Finderimport osclass Statistics:    #treba vymyslieÅ¥ daycount    def __init__(self, ecvTime, ecvNum, firmTime, firmNum, box, boxTime, ztp, ztpFirm, boxes, fromDate= None, toDate= None):        self.ecvTime = ecvTime        self.ecvNum = ecvNum        self.firmTime = firmTime        self.firmNum = firmNum        self.box = box        self.boxTime = boxTime        self.ztp = ztp        self.boxes = boxes        self.ztpFirm = ztpFirm        self.fromDate = fromDate        self.dayCount = int((toDate - fromDate).days)        print(self.dayCount)        self.toDate = toDate        self.f = Finder()        self.generate()            def generate(self):        den = date.today()        textDen = str(den)        path = r'C:\Users\tgyur\Desktop'        newPath = path + '\\' + textDen        if not os.path.exists(newPath):                os.makedirs(newPath)                if self.ecvTime:            self.exportFile(newPath + '\\' +'ecvByTime.csv', ['ecv','time'], self.ecvByTime())        if self.ecvNum:            self.exportFile(newPath + '\\' +'ecvByNum.csv', ['ecv','num'], self.ecvByNum())        if self.firmTime:            self.exportFile(newPath + '\\' +'firmByTime.csv', ['firm','time'], self.firmByTime())        if self.firmNum:            self.exportFile(newPath + '\\' +'firmByNum.csv', ['firm','num'], self.firmByNum())        if self.box:            self.exportFile(newPath + '\\' +'everyBox.csv', ['box','%'], self.everyBox(30))        if self.boxTime:            self.exportFile(newPath + '\\' +'boxInTime.csv', ['box','%'], self.boxInTime(30,self.fromDate,self.toDate))        if self.ztp:            self.exportFile(newPath + '\\' +'ztp.csv', ['box','%'], self.ztpBox(30))        if self.ztpFirm:            self.exportFile(newPath + '\\' +'zptByFirm.csv', ['firm','%'], self.ztpByFirm(30))    def exportFile(self, name, names, data):        with open(name, mode = 'w',newline='') as file:            writer = csv.writer(file, delimiter = ';', quotechar = '"', quoting = csv.QUOTE_MINIMAL)            writer.writerow(names)            if len(data) > 0:                for i in data:                    print(i)                    writer.writerow([i[0], i[1]])    def ecvByTime(self):                records = self.f.findAll(self.fromDate, self.toDate)        stats = dict()        for rec in records:            if rec.ECV in stats:                stats[rec.ECV] = stats[rec.ECV] + (rec.departureTime - rec.arrivalTime)            else:                stats[rec.ECV] = (rec.departureTime - rec.arrivalTime)        sortedStats = sorted(stats.items(), key = lambda kv: kv[1], reverse = True)        return sortedStats    def ecvByNum(self):        records = self.f.findAll(self.fromDate, self.toDate)        stats = dict()        for rec in records:            if rec.ECV in stats:                stats[rec.ECV] = stats[rec.ECV] + 1            else:                stats[rec.ECV] = 1        sortedStats = sorted(stats.items(), key = lambda kv: kv[1], reverse = True)        return sortedStats    def firmByTime(self):        records = self.f.findAll(self.fromDate, self.toDate)        stats = dict()        for rec in records:            if rec.companyId in stats:                stats[rec.companyId] = stats[rec.companyId] + (rec.departureTime - rec.arrivalTime)            else:                stats[rec.companyId] = (rec.departureTime - rec.arrivalTime)        sortedStats = sorted(stats.items(), key = lambda kv: kv[1], reverse = True)        return sortedStats    def firmByNum(self):        records = self.f.findAll(self.fromDate, self.toDate)        stats = dict()        for rec in records:            if rec.companyId in stats:                stats[rec.companyId] = stats[rec.companyId] + 1            else:                stats[rec.companyId] = 1        sortedStats = sorted(stats.items(), key = lambda kv: kv[1], reverse = True)        return sortedStats    def everyBox(self, dayCount):        records = self.f.findAll(self.fromDate, self.toDate)        stats = dict()        for rec in records:            if rec.boxId in stats:                stats[rec.boxId] = stats[rec.boxId] + (((rec.departureTime - rec.arrivalTime)/24)/dayCount)            else:                stats[rec.boxId] = (((rec.departureTime - rec.arrivalTime)/24)/dayCount)                #ked to bude zle tak sorry        sortedStats = sorted(stats.items(), key = lambda kv: kv[1], reverse = True)        return sortedStats                                    def boxInTime(self, dayCount, startRegion, endRegion):        records = self.f.findAll(self.fromDate, self.toDate)        stats = dict()        startParking = None        endParking = None        for rec in records:            if rec.arrivalTime < endRegion:                if rec.departureTime > startRegion:                    if rec.departureTime > endRegion:                        endParking = endRegion                    else:                        endParking = rec.departureTime                    if rec.arrivalTime > startRegion:                        startParking = startRegion                    else:                        startParking = rec.arrivalTime                                            if rec.boxId in stats:                        stats[rec.boxId] = stats[rec.boxId] + (((endParking - startParking)/(endRegion - startRegion))/dayCount)                    else:                        stats[rec.boxId] = (((endParking - startParking)/(endRegion - startRegion))/dayCount)        sortedStats = sorted(stats.items(), key = lambda kv: kv[1], reverse = True)        return sortedStats            def ztpBox(self, dayCount):        records = self.f.findAll(self.fromDate, self.toDate)        stats = dict()        ztpBoxes = set()        for box in self.boxes:            if box.invalid:                ztpBoxes.add(box.boxId)        for rec in records:            if rec.boxId in ztpBoxes:                if rec.boxId in stats:                    stats[rec.boxId] = stats[rec.boxId] + (((rec.departureTime - rec.arrivalTime)/24)/dayCount)                else:                    stats[rec.boxId] = (((rec.departureTime - rec.arrivalTime)/24)/dayCount)        sortedStats = sorted(stats.items(), key = lambda kv: kv[1], reverse = True)        return sortedStats                    def ztpByFirm(self, dayCount):        records = self.f.findAll(self.fromDate, self.toDate)        stats = dict()        ztpBoxes = set()        for box in self.boxes:            if box.invalid:                ztpBoxes.add(box.boxId)                for rec in records:            if rec.boxId in ztpBoxes:                if rec.companyId in stats:                    stats[rec.companyId] = stats[rec.companyId] + (((rec.departureTime - rec.arrivalTime)/24)/dayCount)                else:                    stats[rec.companyId] = (((rec.departureTime - rec.arrivalTime)/24)/dayCount)        sortedStats = sorted(stats.items(), key = lambda kv: kv[1], reverse = True)        return sortedStats                